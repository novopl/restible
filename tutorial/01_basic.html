

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Basic restible App &mdash; restible 0.12.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Using restible.ModelResource" href="02_models.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> restible
          

          
          </a>

          
            
            
              <div class="version">
                0.12.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">1. Basic restible App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-with-an-empty-flask-app">1.1. Start with an empty Flask app</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blogpost-model">1.2. <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-rest-resource-for-blogpost">1.3. Create REST Resource for <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#query-blog-posts">1.3.1. Query blog posts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-single-post">1.3.2. Get single post</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-new-blog-post">1.3.3. Create new blog post</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-blog-post">1.3.4. Update blog post</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-blog-post">1.3.5. Delete blog post</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-flask-urls">1.4. Setup Flask URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#next-steps">1.5. Next steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_models.html">2. Using <code class="docutils literal notranslate"><span class="pre">restible.ModelResource</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ref/restible/index.html">Code Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contrib.html">Working with the code base</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">restible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>1. Basic restible App</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/01_basic.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-restible-app">
<h1>1. Basic restible App<a class="headerlink" href="#basic-restible-app" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can get the full source code for this example
<a class="reference external" href="https://github.com/novopl/restible/tree/master/docs/examples/01_basic">here</a>.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#start-with-an-empty-flask-app" id="id2">Start with an empty Flask app</a></p></li>
<li><p><a class="reference internal" href="#blogpost-model" id="id3"><code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> model</a></p></li>
<li><p><a class="reference internal" href="#create-rest-resource-for-blogpost" id="id4">Create REST Resource for <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#query-blog-posts" id="id5">Query blog posts</a></p></li>
<li><p><a class="reference internal" href="#get-single-post" id="id6">Get single post</a></p></li>
<li><p><a class="reference internal" href="#create-new-blog-post" id="id7">Create new blog post</a></p></li>
<li><p><a class="reference internal" href="#update-blog-post" id="id8">Update blog post</a></p></li>
<li><p><a class="reference internal" href="#delete-blog-post" id="id9">Delete blog post</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#setup-flask-urls" id="id10">Setup Flask URLs</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id11">Next steps</a></p></li>
</ul>
</div>
<p>This is a very basic example of how to expose a model over HTTP as REST API.
The example below is geared toward using the least amount of code to achieve
it’s goals.</p>
<p>For this example we’re using <em>restible</em> with <em>Flask</em> and <em>SQLAlchemy</em> since
it’s easy to set up, allows for self-contained easy to follow code and simple
code. You can also use other underlying frameworks through other integrations
like <strong>restible-django</strong> or <strong>restible-appengine</strong>.</p>
<p>We will build a very simple blogging app. In this example it will have just
one resource, the <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> that will be exposed over HTTP on
<code class="docutils literal notranslate"><span class="pre">/api/post</span></code> URL.</p>
<div class="section" id="start-with-an-empty-flask-app">
<h2><a class="toc-backref" href="#id2">1.1. Start with an empty Flask app</a><a class="headerlink" href="#start-with-an-empty-flask-app" title="Permalink to this headline">¶</a></h2>
<p>We use the most basic flask structure there is: everything is contained within
one <code class="docutils literal notranslate"><span class="pre">main.py</span></code> file. The app is very simple so there’s not need to split it
up yet.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot; A very basic example of how to expose a model over HTTP as REST API. &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="c1"># stdlib imports</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="c1"># 3rd party imports</span>
<span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">import</span> <span class="nn">flask_sqlalchemy</span>
<span class="kn">import</span> <span class="nn">restible</span>
<span class="kn">import</span> <span class="nn">restible.util</span>
<span class="kn">import</span> <span class="nn">restible_flask</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="k">import</span> <span class="n">SQLAlchemyError</span>


<span class="n">db</span> <span class="o">=</span> <span class="n">flask_sqlalchemy</span><span class="o">.</span><span class="n">SQLAlchemy</span><span class="p">()</span>
<span class="n">DATETIME_FMT</span> <span class="o">=</span> <span class="s1">&#39;%Y-</span><span class="si">%d</span><span class="s1">-%m %H:%M:%S&#39;</span>


<span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">:</span> <span class="s1">&#39;sqlite:///data.sqlite&#39;</span><span class="p">,</span>
        <span class="s1">&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>And here are the project requirements for this app:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Flask</span><span class="o">==</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">2</span>
<span class="n">Flask</span><span class="o">-</span><span class="n">SQLAlchemy</span><span class="o">==</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">2</span>
<span class="n">restible</span><span class="o">==</span><span class="mf">0.11</span>
<span class="n">restible</span><span class="o">-</span><span class="n">flask</span><span class="o">==</span><span class="mf">0.2</span>
<span class="n">pytest</span><span class="o">==</span><span class="mf">4.4</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="blogpost-model">
<h2><a class="toc-backref" href="#id3">1.2. <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> model</a><a class="headerlink" href="#blogpost-model" title="Permalink to this headline">¶</a></h2>
<p>Next we create a simple model to persist our blog posts. Only the bare minimum
here as that’s not the point.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPost</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATETIME_FMT</span><span class="p">),</span>
            <span class="s1">&#39;updated_at&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATETIME_FMT</span><span class="p">),</span>
        <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="create-rest-resource-for-blogpost">
<h2><a class="toc-backref" href="#id4">1.3. Create REST Resource for <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code></a><a class="headerlink" href="#create-rest-resource-for-blogpost" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogPostResource</span><span class="p">(</span><span class="n">restible</span><span class="o">.</span><span class="n">RestResource</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span>
    <span class="n">route_params</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;post_pk&quot;</span><span class="p">}]</span>

</pre></div>
</td></tr></table></div>
<p>This is the REST resource associated with the BlogPost model. We’re using
<a class="reference internal" href="../ref/restible/resource.html#restible.resource.RestResource" title="restible.resource.RestResource"><code class="xref any py py-class docutils literal notranslate"><span class="pre">resource.RestResource</span></code></a> which comes with least amount of functionality built-in.
Everything has to be done manually. There are more base resource classes
provided by restible and third party libraries.</p>
<p>Here we just want to kick things of with the simplest one (rarely used in real
apps).</p>
<div class="section" id="query-blog-posts">
<h3><a class="toc-backref" href="#id5">1.3.1. Query blog posts</a><a class="headerlink" href="#query-blog-posts" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">rest_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<p>Here we define the generic <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/post</span></code> route. In our case it will return
all blog posts stored by the backend.</p>
<p>In real app, this will probably also support some filtering of the results
and possibly pagination as well.</p>
</div>
<div class="section" id="get-single-post">
<h3><a class="toc-backref" href="#id6">1.3.2. Get single post</a><a class="headerlink" href="#get-single-post" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">rest_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="n">post_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pk</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">post_id</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;Blog post #</span><span class="si">{}</span><span class="s2"> not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">post_id</span><span class="p">)}</span>
</pre></div>
</td></tr></table></div>
<p>This is the detail route to get a blog post by ID (<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/api/post/&lt;post_id&gt;</span></code>).
<strong>restible</strong> provides a handy method for getting the route param
associated with the request: <a class="reference internal" href="../ref/restible/resource.html#restible.resource.RestResource.get_pk" title="restible.resource.RestResource.get_pk"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">RestResource.get_pk</span></code></a>. It will take into
account the</p>
</div>
<div class="section" id="create-new-blog-post">
<h3><a class="toc-backref" href="#id7">1.3.3. Create new blog post</a><a class="headerlink" href="#create-new-blog-post" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">rest_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">session</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Our basic validation only checks if all fields are present.</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">restible</span><span class="o">.</span><span class="n">BadRequest</span><span class="p">(</span><span class="s2">&quot;Missing fields: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing</span><span class="p">))</span>

            <span class="c1"># Create a new BlogPost record and commit it to database.</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="p">(</span><span class="o">**</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="k">return</span> <span class="mi">201</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;DB ERROR: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">)}</span>
</pre></div>
</td></tr></table></div>
<p>Next up is the blog post create handler (<code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/api/post</span></code>). In this basic
example we only do a very simple validation - are all the required fields
present. You can have a more complex validation logic in real life, but as we’ll
learn later in this tutorial series, <strong>restible</strong> has some tools for that as
well. Here we won’t be using them to keep things as simple as possible.</p>
</div>
<div class="section" id="update-blog-post">
<h3><a class="toc-backref" href="#id8">1.3.4. Update blog post</a><a class="headerlink" href="#update-blog-post" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">rest_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">session</span>
        <span class="n">post_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pk</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

        <span class="c1"># Find the blog post we want to update.</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">post_id</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">404</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;Blog post #</span><span class="si">{}</span><span class="s2"> not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">post_id</span><span class="p">)}</span>

        <span class="c1"># Make sure we do not overwrite read only fields.</span>
        <span class="n">read_only</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_at&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">read_only</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Update the database record and commit.</span>
            <span class="n">restible</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">update_from_values</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="k">return</span> <span class="mi">200</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;DB ERROR: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">)}</span>
</pre></div>
</td></tr></table></div>
<p>Here we allow the users to update any existing post (<code class="docutils literal notranslate"><span class="pre">PUT</span> <span class="pre">/api/post/&lt;post_id&gt;</span></code>).
The code is pretty self-explanatory, but there are a few things we can point out
here. As you can see we remove few values from the payload to prevent overwriting
them (they are set automatically by the backend and user should not be able to
overwrite those).</p>
<p>Another thing is the use of <a class="reference internal" href="../ref/restible/util.html#restible.util.update_from_values" title="restible.util.update_from_values"><code class="xref any py py-func docutils literal notranslate"><span class="pre">restible.util.update_from_values</span></code></a>.
This is a small helper function that will take each item in <em>values</em> (second
argument) and set the corresponding attribute on the object passed to it as the
first argument (<em>post</em> in this case). The first argument doesn’t have to be a
model, any python object will do (as long as you can set each of the properties
passed in <em>values</em>).</p>
</div>
<div class="section" id="delete-blog-post">
<h3><a class="toc-backref" href="#id9">1.3.5. Delete blog post</a><a class="headerlink" href="#delete-blog-post" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">rest_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">session</span>
        <span class="n">post_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pk</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">BlogPost</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">BlogPost</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">post_id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">204</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;Blog post #</span><span class="si">{}</span><span class="s2"> deleted&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">post_id</span><span class="p">)}</span>
        <span class="k">except</span> <span class="n">SQLAlchemyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">500</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;detail&#39;</span><span class="p">:</span> <span class="s2">&quot;DB ERROR: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">)}</span>
</pre></div>
</td></tr></table></div>
<p>And last but not least: deleting posts (<code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">/api/post/&lt;post_id&gt;</span></code>). Not
much left to say here, just get the ID of the requested post and delete it from
database.</p>
</div>
</div>
<div class="section" id="setup-flask-urls">
<h2><a class="toc-backref" href="#id10">1.4. Setup Flask URLs</a><a class="headerlink" href="#setup-flask-urls" title="Permalink to this headline">¶</a></h2>
<p>Now that we have our API resource defined, the last thing to do is setup the
flask URL mappings. For that, we will use an integration library
<a class="reference external" href="https://github.com/novopl/restible-flask">restible-flask</a> and the
<code class="docutils literal notranslate"><span class="pre">Endpoint</span></code> class provided by it. You just need to pass the resource base URL
and the associated resource class.</p>
<p>The resource &lt;-&gt; URL mapping is the one thing that will be very differente
depending on what framework/libraries are you using to power restible.
<a class="reference external" href="https://github.com/novopl/restible-flask">restible-flask</a>,
<a class="reference external" href="https://github.com/novopl/restible-django">restible-django</a> and
<a class="reference external" href="https://github.com/novopl/restible-appengine">restible-appengine</a> all have a
different way of mapping the URLs, for more information consult the docs for
the library of your choosing.</p>
<p>In general, the resource definitions (not models) should be easy to move when
you change the underlying libraries framewroks, but the mapping of those
resources onto URL fully depends on the underlying library and thus can be very
different.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">:</span> <span class="s1">&#39;sqlite:///data.sqlite&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span class="hll">    <span class="p">})</span>
</span><span class="hll">
</span>    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

        <span class="n">restible_flask</span><span class="o">.</span><span class="n">Endpoint</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;/api/post&#39;</span><span class="p">,</span> <span class="n">BlogPostResource</span><span class="p">],</span>
        <span class="p">])</span>

    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id11">1.5. Next steps</a><a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>In the <a class="reference internal" href="02_models.html"><span class="doc">next section</span></a> we will reimplement the same
app, but this time we will use <a class="reference internal" href="../ref/restible/model.html#restible.model.ModelResource" title="restible.model.ModelResource"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ModelResource</span></code></a> instead of <a class="reference internal" href="../ref/restible/resource.html#restible.resource.RestResource" title="restible.resource.RestResource"><code class="xref any py py-class docutils literal notranslate"><span class="pre">RestResource</span></code></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="02_models.html" class="btn btn-neutral float-right" title="2. Using restible.ModelResource" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, Mateusz &#39;novo&#39; Klos.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.12.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>